<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>🧧 2026 正念慈心能量指引 🧧</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@500;700;900&family=Ma+Shan+Zheng&display=swap" rel="stylesheet">
    <style>
        :root {
            --festive-red: #c62828;
            --gold: #d4af37;
            --light-gold: #f9f1c0;
            --healing-purple: #6a1b9a;
            --bg-gradient: linear-gradient(135deg, #7b1fa2 0%, #c62828 100%);
        }

        body {
            font-family: "Noto Serif TC", serif;
            background: var(--bg-gradient);
            display: flex; align-items: center; justify-content: center;
            min-height: 100vh; margin: 0; padding: 20px; box-sizing: border-box;
            position: relative;
        }

        /* 右上角選單優化 */
        .top-links {
            position: absolute;
            top: 15px;
            right: 15px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            text-align: right;
            z-index: 100;
            max-width: 250px;
        }

        .link-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .link-header {
            font-size: 0.75rem;
            color: var(--light-gold);
            font-weight: 900;
            letter-spacing: 1px;
            margin-bottom: 2px;
            text-transform: uppercase;
        }

        .top-links a {
            color: #fff;
            text-decoration: none;
            font-size: 0.85rem;
            font-weight: 700;
            background: rgba(106, 27, 154, 0.75); 
            padding: 6px 14px;
            border-radius: 12px;
            border: 1px solid var(--gold);
            transition: 0.3s;
            line-height: 1.4;
            display: block;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }

        .top-links a:hover {
            background: var(--healing-purple);
            transform: translateX(-5px);
            box-shadow: 0 6px 15px rgba(0,0,0,0.3);
            border-color: #fff;
        }

        /* 活動連結特別樣式 */
        .event-link {
            border-left: 4px solid var(--light-gold) !important;
        }

        .main-container {
            text-align: center;
            background: rgba(255, 255, 255, 0.98);
            padding: 40px 25px; border-radius: 25px;
            box-shadow: 0 25px 55px rgba(0,0,0,0.4);
            max-width: 500px; width: 100%;
            border: 4px solid var(--gold);
            position: relative;
            margin-top: 60px; /* 為右上角選單留空間 */
        }

        h1 { 
            font-family: 'Ma Shan Zheng', cursive; 
            color: var(--festive-red); 
            font-size: 2.5rem; 
            margin: 0;
            text-shadow: 1px 1px 0px rgba(0,0,0,0.1);
        }
        .subtitle { 
            font-size: 1.05rem; 
            color: #444; 
            margin: 15px 0 25px; 
            font-weight: 700; 
            line-height: 1.7;
            padding: 0 10px;
        }

        .category-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 20px; }
        .cat-btn {
            background: white; border: 2.5px solid var(--festive-red); padding: 18px 5px;
            border-radius: 15px; cursor: pointer; font-size: 1.15rem; font-weight: 900;
            color: var(--festive-red); transition: all 0.2s;
            box-shadow: 0 4px 0 var(--festive-red);
        }
        .cat-btn:active { transform: translateY(3px); box-shadow: 0 1px 0 var(--festive-red); }

        .scratch-card-wrapper {
            position: relative; width: 320px; height: 180px;
            margin: 0 auto 20px; border-radius: 15px;
            overflow: hidden; border: 4px solid var(--gold);
            background: #fff; display: none;
            box-shadow: inset 0 0 10px rgba(0,0,0,0.1);
        }

        .prize-layer {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            display: flex; align-items: center; justify-content: center;
            font-size: 1.25rem; line-height: 1.6; color: var(--healing-purple);
            padding: 25px; box-sizing: border-box; text-align: center; font-weight: 900;
        }

        #scratch-canvas { position: absolute; top: 0; left: 0; z-index: 10; cursor: crosshair; touch-action: none; }
        #status { margin-top: 15px; font-weight: 700; color: var(--festive-red); min-height: 1.5em; font-size: 1.15rem; }
        
        .retry-link {
            display: inline-block;
            margin-top: 20px;
            color: var(--healing-purple);
            text-decoration: underline;
            cursor: pointer;
            font-weight: 700;
            font-size: 1.1rem;
        }

        .hidden { display: none !important; }

        @media (max-width: 480px) {
            .top-links { position: relative; top: 0; right: 0; width: 100%; text-align: center; margin-bottom: 10px; align-items: center; }
            .link-group { align-items: center; }
            .main-container { margin-top: 10px; }
            h1 { font-size: 2.1rem; }
            .scratch-card-wrapper { width: 280px; height: 160px; }
        }
    </style>
</head>
<body>

<div class="top-links">
    <div class="link-group">
        <div class="link-header">近期活動 ✨</div>
        <a href="https://himind.pse.is/balance2026" target="_blank" class="event-link">免費報名 Zoom：自律神經平衡課</a>
        <a href="https://himind.pse.is/8lax8f" target="_blank" class="event-link">免費報名 Zoom：神奇能量鎚教學</a>
    </div>
    <div class="link-group" style="margin-top: 5px;">
        <div class="link-header">學習資源</div>
        <a href="https://www.facebook.com/mindfulness.tw" target="_blank">更多正念學習</a>
        <a href="https://www.facebook.com/HiMindHealing" target="_blank">更多能量學習</a>
    </div>
</div>

<div class="main-container">
    <div style="font-size: 2.5rem; margin-bottom: 10px;">🧧 ✨ 🧘</div>
    <h1>2026 正念慈心能量指引</h1>
    <p id="top-msg" class="subtitle">請在內心先清楚默念您的問題<br>然後選擇一個您最關心的議題<br>領取宇宙今日給您的啟示</p>

    <div id="category-screen" class="category-grid">
        <button class="cat-btn" onclick="selectCategory('健康')">🍏 健康</button>
        <button class="cat-btn" onclick="selectCategory('關係')">❤️ 關係</button>
        <button class="cat-btn" onclick="selectCategory('心靈')">🧘 心靈</button>
        <button class="cat-btn" onclick="selectCategory('事業')">🚀 事業</button>
        <button class="cat-btn" onclick="selectCategory('財富')">💰 財富</button>
        <button class="cat-btn" onclick="selectCategory('靈魂功課')">💎 靈魂功課</button>
        <button class="cat-btn" style="grid-column: span 2;" onclick="selectCategory('重要決策')">⚖️ 重要決策要不要</button>
    </div>

    <div id="scratch-screen" class="scratch-card-wrapper">
        <div id="prize-text" class="prize-layer"></div>
        <canvas id="scratch-canvas" width="320" height="180"></canvas>
    </div>

    <div id="status"></div>
    <div id="retry-container" class="hidden">
        <span class="retry-link" onclick="resetGame()">想再刮一次嗎？</span>
    </div>
</div>

<script>
    const CONTENT_DATA = {
        "健康": [
            "呼吸是最好的良藥，現在就跟著導引深呼吸三次。",
            "你的細胞正在聽你說話，對它們溫柔地說聲「謝謝」。",
            "休息不是浪費時間，是讓過載的神經系統重新對齊。",
            "身體的疼痛是靈魂發出的簡訊，請試著讀懂它的提醒。",
            "喝一杯純淨的水，想像它正在淨化你的每個細胞。",
            "修復發生在深度睡眠中，今晚放下手機早點睡。",
            "放慢呼吸，讓大腦接收到「此刻是安全的」訊號。",
            "不要急著「修好」身體，先學會與這份不舒服溫柔同在。",
            "伸展你的脊椎，讓堵塞的生命能量流動更順暢。",
            "閉上眼，感受心跳力量，那是生命時刻給你的禮物。",
            "生活方式就是細胞程式碼，安定心神就是在保護端粒。",
            "走進自然接地氣，讓大地修復你的粒線體。",
            "身體比大腦更誠實，請學會聽從發出的能量直覺。",
            "每天流一點汗，排掉的不只是毒素，還有卡住的情緒。",
            "溫柔地對待你的眼睛，暫離螢幕，看看遠方的綠意。",
            "靜坐十分鐘，讓自律神經回到平衡的生命律動中。",
            "你的笑容是最好的免疫增強劑，對鏡中的自己微笑吧。",
            "以前靠意志力硬撐，現在請學會溫柔陪伴身體的極限。",
            "腹式呼吸能瞬間降低壓力皮質醇，找回內在穩定感。",
            "把手放在不舒服的地方，送出慈愛的白光安撫它。",
            "規律是身體的節奏，別為未來對現在的健康借高利貸。",
            "每一口食物細嚼慢嚥，這是一場與大地的滋養約會。",
            "洗澡時想像水流帶走了一整天累積的身心負荷。",
            "挺胸迎向陽光，用充滿力量的姿勢來翻轉能量。",
            "減少糖分攝取，讓情緒波動保持在平穩的震動頻率。",
            "愛你的身體，無論它現在如何，它都辛苦了。",
            "每一根骨頭都支撐著夢想，感謝它們的辛勤付出。",
            "睡前做感恩身體掃描，讓能量從頭到腳平安回家。",
            "聆聽輕柔頻率，調整大腦波長，進入深層放鬆。",
            "適度的斷食與留白，是給腸胃一場神聖的修復假期。",
            "體力是意志力的燃料，別在空檔讓能量原地打轉。",
            "保持水分流動，心念清澈能量就會清澈。",
            "放下肩膀鬆開下巴，讓副交感神經啟動修復機制。",
            "別讓緊繃成為習慣動作，現在就放鬆雙肩。",
            "今天，請給這個一直努力撐著的自己一個大大的擁抱。",
            "新的健康來自新的回應方式，從呼吸開始改變。"
        ],
        "關係": [
            "關係是一面鏡子，映照出你內在尚未修補的地方。",
            "先成為你想要吸引的那種人，能量決定你的相遇。",
            "溝通前先深呼吸，從「心」出發而非情緒反應。",
            "健康的愛需要清晰的界線，為彼此保留呼吸空間。",
            "原諒別人是為了放過自己，不再被舊傷能量綑綁。",
            "真正的親密，來自敢在信任的人面前展現脆弱。",
            "每個人都在用「已知最好」方式生活，包括父母。",
            "停止期待別人完整你，你要看見自己本自具足。",
            "把「你都不懂我」換成「我希望你能多在意我一點」。",
            "有些人的離開是宇宙在移開不適合的關係連結。",
            "練習正念傾聽，聽見句子背後想被理解的渴望。",
            "給予而不求回報，愛才會形成豐盛完美的循環。",
            "孤獨是與靈魂對話的機會，練習在孤獨中安住。",
            "價值不住在別人的選擇裡，不論誰離開你的價值都在。",
            "爭吵時問自己：我現在要的是「贏」還是「愛」？",
            "關係中的留白，是讓彼此情感重新呼吸的空間。",
            "感謝讓你痛苦的人，他們是生命的喚醒導師。",
            "溫柔言語與真實表達，能融化最堅硬的防衛冰山。",
            "不必討好每一個人，你不是為別人期待而活。",
            "當孩子鬧脾氣時，先蹲下來抱一抱，接住他的情緒。",
            "放下想要控制對方的慾望，讓關係在尊重中自然生長。",
            "每天對重要的人說聲「謝謝」，累積彼此的情感存款。",
            "你的社交圈決定震動頻率，請優化你的能量環境。",
            "體貼的人常忘了自己，請學會對不合理溫柔說不。",
            "愛是動詞，透過正念陪伴讓對方感覺他有重量。",
            "面對已逝親人，用感恩與祝福來圓滿連結。",
            "拒絕情緒勒索，也不要勒索他人，讓愛自由流動。",
            "衝突的底層往往是一份對愛與安全感的需求。",
            "擁抱時感受心跳同步，那是靈魂最深的對話。",
            "關係品質取決於你對待自己內在小孩的品質。",
            "對他人展現慈悲，因為每個人都在經歷一場硬仗。",
            "誠實是最高級的性感，真誠表達能縮短心的距離。",
            "遠離持續消耗能量的人，這是自保而非自私。",
            "謝謝這段關係真實存在過，頻率不同就溫柔道別。",
            "珍惜當下陪伴，接受無常是生命流動的常態。",
            "愛不是佔有，學會欣賞對方最自然盛開的樣子。"
        ],
        "心靈": [
            "你不是你的想法，你是觀察想法起伏的清明意識。",
            "活在當下，是唯一一個你可以安頓靈魂的時刻。",
            "全然接納此時此刻的發生，內心痛苦就會減半。",
            "心中若有風景，即便身處鬧市也是世外桃源。",
            "每天花五分鐘練習 Being 模式，單純地存在著。",
            "焦慮是為尚未發生的劇情，預付了高昂情緒稅金。",
            "心是天空，情緒是雲，不需驅趕也不需抓住。",
            "所有的生命答案，都會在安靜的覺察中自然浮現。",
            "專注力像是肌肉，需要被溫柔持續地訓練。",
            "放下對完美的執著，承認不完美也是一種真實的美。",
            "感恩產生療癒頻率，讓心從匱乏轉向豐盛。",
            "信任宇宙節奏，即便看不清全貌，一切都在路上。",
            "恐懼對面不是勇敢，而是對生命全然的信任。",
            "內在小孩一直在等你，去聽聽他、抱抱他，告訴他你在。",
            "覺得自己不夠好時是舊標籤，不代表真實的你。",
            "靈魂來這一趟不需成功證明，靈魂只需要豐富經歷。",
            "保持初心，像孩子一樣對世界微小驚喜保持好奇。",
            "平常心就是道，在平凡中看見生命的神聖感。",
            "每一朵花在自己的節奏中綻放，你也可以按自己的步調。",
            "把心打開不要帶著既定計畫，奇蹟才有位置進來。",
            "斷捨離不只是清物品，更是鬆動內在卡住的陳舊信念。",
            "憤怒升起時試著識別它、允許它，用慈悲安撫自己。",
            "願我平安、願我健康，慈心祝福會改變你的氣場。",
            "逆境是包裹醜陋的禮物，拆開裡面藏著智慧。",
            "所有的發生都是為了利益你，即便當下是個挫折。",
            "心安理得是這個時代最高級且最珍貴的奢侈品。",
            "不隨境轉，你的心就是穩固的舵，帶領你度過風暴。",
            "溫柔對待負面情緒，問問這份鬱卒想告訴你什麼。",
            "智慧在沈默中生根，在帶著覺察的行動中開花。",
            "當你覺得被攻擊，是內在舊傷準備好被看見療癒了。",
            "活出你自己的真實與光亮，是對世界最好的貢獻。",
            "簡單是複雜之後的終極境界，讓生活回歸純粹。",
            "練習「不評價」，在覺察當下給自己溫和空間。",
            "念頭只是種子，選擇種下正向的種子但不執著結果。",
            "當心很亂時把注意力帶回腳底，讓每一步都穩落地。",
            "回家吧，回到你內在那個永恆平靜、本自具足的中心。"
        ],
        "事業": ["事業不是生存的苦役，而是生命能量的延伸。","專注力是最珍貴的資產，別浪費在無效的干擾。","每一份任務，都是一場動態的正念冥想。","當你感到疲憊，是因為在「對抗」而非「流動」。","最好的工作狀態是：放鬆、專注、慈悲。","卓越源於內心的寧靜，而非外界的嘈雜。","事業高度取決於內在能量的穩定度。","帶著覺察工作，最微小的細節都能閃耀。","專注於「給予」而非「獲取」，豐盛自來。","療癒金錢恐懼，事業生命能量才會流動。","拒絕多工處理，一次只溫柔地做好一件事。","競爭是幻象，貢獻才是靈魂的真相。","成功是活出真正的自己，不是贏過別人。","喧囂的會議中，記得回到自己的呼吸。","專業是軀殼，慈悲心才是事業的靈魂。","收入是宇宙對你付出能量的感謝狀。","保持「初心」，那是能量永不乾涸的源頭。","深度專注一小時，勝過焦慮地工作一天。","事業不僅是賺錢，更是人間修行的道場。","減少不必要的言語，讓行動更有能量。","生活與工作的整合，來自對當下的接納。","帶著療癒他人的意圖服務，事業無堅不摧。","判斷力來自清明的神智，而非混亂忙碌。","解決問題的最高境界，是從源頭消融衝突。","生命能量在哪裡，你的成就就在哪裡。","合作對象是來映照你內在狀態的導師。","壓力中放鬆肩膀，是給身體的慈心祝福。","真正的領導力，是啟發他人的內在能量。","創業是關於「創造」，而非關於「佔有」。","不再證明自己時，真正的力量才會顯現。","創意是在留白空間裡由靈魂寫下的答案。","拒絕耗能的邀約，守護事業的純粹。","把專長轉化為愛，這就是最成功的事業。","信任生命的節奏，有時前進，有時留白。","你的存在本身，就是事業最核心的價值。","今天，請帶著喜悅與正念去創造世界。"],
        "財富": ["金錢是價值的交換，問自己今天創造了什麼。","財富是放大鏡，讓善良的人更有影響力。","人們買的是「解決方案」與「更好的自己」。","豐盛是意識到「本自具足」並有能力給予。","記下每筆支出，覺察你的能量流向哪裡。","別說買不起，改問要如何才能擁有它。","市場只會對你的「成果」付費，而非努力。","財富喜歡流動：帶著祝福付費，感恩收錢。","真正豐盛是擁有拒絕不符價值觀的自由。","投資大腦是唯一不會被通膨吃掉的資產。","人性需求是安全、健康、愛。你提供了嗎？","匱乏來自比較，豐盛來自對當下的覺察。","你值得擁有財富，財富能讓你更好服務世界。","做市場需要且你擅長的事，而非只做喜歡的事。","複利不只在銀行，也在微小的技能累積中。","給予是豐盛起點：分享知識、時間或小愛。","財富規模取決於解決問題的深度與廣度。","覺察你是因為「恐懼」存錢，還是「愛」增值。","清理錢包與財務報表，為新能量騰空間。","在別人恐懼時保持清明，貪婪時守住紀律。","放下「賺錢很辛苦」信條，聰明創造價值。","財富是時間的槓桿：學會運用系統與工具。","安靜聆聽客戶抱怨，那裡藏著未滿足商機。","帶著服務心談判，市場能量會輕盈順暢。","今天就處理掉一筆困擾已久的財務雜事。","內在豐盛吸引外在財富，行動是顯化橋樑。","別讓過去失敗定義身價，每一秒都是新開始。","建立緊急預備金，給靈魂安全感的燃料。","將產品或服務簡化到極致，就是價值。","當急於致富時，那是小我在干擾判斷。","設定具體財務目標，並寫下前三個小步驟。","財富是判斷力副產品，來自對現實的觀察。","祝福比你富有的人，打破你的匱乏障壁。","市場沒有好壞，只有供需，找到你的定位。","富有是即便失去金錢，仍有重新創造的能力。","對幫助你創造財富的人表達真誠感謝。"],
        "靈魂功課": ["來到這世上，是為了憶起你到底是誰。","所有的痛苦，都是靈魂覺醒的催化劑。","遇見的每個人，都是靈魂契約的一部分。","重複出現的問題，提醒你還有未完的功課。","放下受害者角色，拿回你的創造者力量。","地球是一所學校，生活就是你的課程。","靈魂不在乎成敗，只在乎你是否學會愛。","恐懼是靈魂邊界指標，跨過去就是成長。","業力不是懲罰，而是平衡與學習的禮物。","接納自己的陰影，是完整自己的必經之路。","慈悲，是靈魂最高級的震動頻率。","臣服於生命之流，不要與宇宙節奏對抗。","直覺是靈魂的耳語，請信任這份指引。","孤獨是靈魂在深呼吸，與真實自己相遇。","失去是為了騰出空間給更適合的安排。","這一世功課，是學會勇敢地做真實自己。","寬恕是斬斷靈魂枷鎖最快的方式。","存在本身就是意義，不需向世界證明。","苦難中隱藏智慧寶藏，請耐心挖掘。","靈魂沒有時間感，只有當下的純粹體驗。","尋找內在平靜，那是你靈魂真正的家。","服務他人，是靈魂最高形式的表達。","身體是借來的，靈魂才是永恆的。","學會分辨「小我」慾望與「大我」呼喚。","所有的恐懼底層，都是對生命的誤解。","靈魂喜歡玩耍，別把人生過得太嚴肅。","你正經歷的，正是靈魂當下最需要的。","靜修不是逃避，是為了更有力量地回歸。","愛是唯一的真實，其他都是幻象。","保持靈魂純真，即使看透了世俗紛擾。","是被全宇宙寵愛著的，你從未孤單。","向內看，那裡有你尋找的所有寶藏。","生命的意義，是由你親手賦予它的。","在平凡的呼吸中，看見神聖的光芒。","靈魂選擇了這個時代、家庭與身體。","最終，我們都只是互相陪伴著回家。"],
        "重要決策": ["若感到胸口緊繃，請先為決定緩一緩。","如果是「還可以」的選擇，那就是一個「不」。","詢問你的心，而不是詢問你的恐懼。","在安靜的森林或安靜的房間裡做決定。","想像十年後的你，會如何看待現在的選擇。","如果不考慮錢，你會怎麼選？那就是答案。","投一枚硬幣，落地前你希望它是哪一面。","好的決定讓你感到平靜，而不是興奮。","暫時放下，睡一覺，醒來答案會更清晰。","尋求智者意見，但最後請聽從自己。","若決定基於愛而非恐懼，那就去做吧。","宇宙喜歡行動，決定了就全心投入。","現在不是最好時機，再等一個月亮週期。","Yes！大膽往前走，資源已經在路上了。","過多的選擇會消耗能量，試著減少選項。","問問自己：這符合我的核心價值觀嗎？","擴張感是「對」，縮小緊繃感是「錯」。","慢慢來，有時比較快。","這個決策是否能讓你獲得真正的自由。","不要為了逃避現在，而急著做決定。","答案就在夢境裡，請留意晨間的啟示。","先做一個小實驗，再決定是否全面投入。","相信第一直覺，後面的都是腦袋干擾。","如果你猶豫不決，表示你還沒準備好。","向宇宙發請求，請它給你明確的信號。","這個決定是否能為更多人帶來福祉。","勇敢說「不」，是為了對更重要的說「好」。","所有的路徑最終都會通往成長與生命。","別人的建議是參考，你才是人生機長。","寫下優缺點，但最後請用直覺決定。","當下即是最佳時機，不要等待完美。","繞一點路沒關係，風景可能更優美。","放下對結果執著，專注於當下的行動。","你的靈魂深處，其實已經知道答案了。","走那條讓你感到更有生命力的路。","帶著微笑，然後堅定出發。"]
    };

    const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwi5iuc-COjsq5ab84OpRjgki3dRLXAFOywueWHCnq64FNbOVq0VpgcSVkz8x_Lb5yoiw/exec";

    let selectedCat = "";
    let selectedContent = "";
    let isFinished = false;

    const canvas = document.getElementById('scratch-canvas');
    const ctx = canvas.getContext('2d');
    const prizeDiv = document.getElementById('prize-text');
    const statusDiv = document.getElementById('status');
    const retryContainer = document.getElementById('retry-container');

    function selectCategory(cat) {
        selectedCat = cat;
        const list = CONTENT_DATA[cat];
        selectedContent = list[Math.floor(Math.random() * list.length)];
        
        document.getElementById('category-screen').classList.add('hidden');
        document.getElementById('scratch-screen').style.display = 'block';
        document.getElementById('top-msg').innerHTML = `已為您連結【${cat}】能量<br>請靜心刮開宇宙的叮嚀`;
        
        initScratch();
    }

    function initScratch() {
        isFinished = false;
        canvas.style.opacity = '1';
        canvas.classList.remove('hidden');
        prizeDiv.innerText = selectedContent;
        statusDiv.innerText = "";
        retryContainer.classList.add('hidden');
        
        ctx.globalCompositeOperation = 'source-over';
        ctx.fillStyle = '#d4af37';
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        
        ctx.shadowColor = "rgba(0,0,0,0.2)";
        ctx.shadowBlur = 1;
        ctx.fillStyle = '#c62828';
        ctx.font = '900 26px "Noto Serif TC"'; 
        ctx.textAlign = 'center';
        ctx.fillText('請在這邊刮開內容', canvas.width/2, canvas.height/2 + 10);

        canvas.addEventListener('mousedown', startScratch);
        canvas.addEventListener('mousemove', scratch);
        window.addEventListener('mouseup', stopScratch);
        canvas.addEventListener('touchstart', startScratch, {passive:false});
        canvas.addEventListener('touchmove', scratch, {passive:false});
        canvas.addEventListener('touchend', stopScratch);
    }

    let isDrawing = false;
    function startScratch(e) { isDrawing = true; scratch(e); }
    function stopScratch() { if(isDrawing) { isDrawing = false; checkScrape(); } }

    function scratch(e) {
        if (!isDrawing || isFinished) return;
        if(e.cancelable) e.preventDefault();
        const rect = canvas.getBoundingClientRect();
        const clientX = e.touches ? e.touches[0].clientX : e.clientX;
        const clientY = e.touches ? e.touches[0].clientY : e.clientY;
        const x = clientX - rect.left;
        const y = clientY - rect.top;

        ctx.globalCompositeOperation = 'destination-out';
        ctx.beginPath();
        ctx.arc(x, y, 22, 0, Math.PI * 2);
        ctx.fill();
    }

    function checkScrape() {
        const pixels = ctx.getImageData(0, 0, canvas.width, canvas.height).data;
        let clear = 0;
        for (let i = 3; i < pixels.length; i += 4) if (pixels[i] === 0) clear++;
        
        if ((clear / (canvas.width * canvas.height)) > 0.45) {
            isFinished = true;
            canvas.style.transition = 'opacity 0.6s';
            canvas.style.opacity = '0';
            setTimeout(autoRecord, 600);
        }
    }

    function autoRecord() {
        canvas.classList.add('hidden');
        statusDiv.innerText = "慢慢靜心體會...";
        
        const payload = {
            category: selectedCat,
            content: selectedContent
        };

        fetch(GOOGLE_SCRIPT_URL, {
            method: 'POST',
            mode: 'no-cors',
            body: JSON.stringify(payload)
        }).then(() => {
            finishAction();
        }).catch(() => {
            finishAction();
        });
    }

    function finishAction() {
        statusDiv.innerHTML = "🙏 願這份啟示帶給您智慧，祝福2026年行大運。";
        retryContainer.classList.remove('hidden');
    }

    function resetGame() {
        document.getElementById('scratch-screen').style.display = 'none';
        document.getElementById('category-screen').classList.remove('hidden');
        document.getElementById('top-msg').innerHTML = "1. 內心先默念您的問題<br>2.選擇一個您最關心的議題<br>3.領取宇宙給您的啟示";
        statusDiv.innerText = "";
        retryContainer.classList.add('hidden');
    }
</script>

</body>
</html>
