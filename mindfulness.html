<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2026 åˆ®åˆ®æ¨‚ - æ­£å¿µæˆ‘çš„å¿ƒ</title>
    <style>
        :root {
            --primary-color: #5b8e7d;
            --bg-color: #f4f7f6;
            --silver: #C0C0C0;
        }
        body {
            font-family: 'PingFang TC', 'Microsoft JhengHei', sans-serif;
            background-color: var(--bg-color);
            margin: 0; padding: 20px;
            display: flex; flex-direction: column; align-items: center;
            color: #333; line-height: 1.6;
        }

        /* ä»‹é¢åˆ‡æ›æ§åˆ¶ */
        .page { display: none; width: 100%; max-width: 500px; text-align: center; }
        .page.active { display: block; }

        header h1 { color: #2c5d4d; font-size: 1.5rem; margin-bottom: 20px; }
        .instruction-box { background: white; padding: 20px; border-radius: 15px; margin-bottom: 20px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); }
        .instruction-box ol { text-align: left; display: inline-block; }

        /* åˆ†é¡é¸æ“‡ */
        .category-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-top: 20px; }
        .cat-item {
            padding: 15px 5px; background: white; border-radius: 12px; border: 2px solid #ddd;
            cursor: pointer; transition: 0.3s; font-weight: bold; font-size: 0.9rem;
        }
        .cat-item.selected { border-color: var(--primary-color); background: #e8f3f0; color: var(--primary-color); transform: scale(1.05); }

        /* åˆ®åˆ®æ¨‚å¡ç‰‡ */
        #scratch-card {
            width: 320px; height: 450px; background: white; margin: 20px auto;
            border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            position: relative; overflow: hidden;
        }
        .result-content {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            padding: 30px; box-sizing: border-box; text-align: center;
        }
        canvas { position: absolute; top: 0; left: 0; cursor: crosshair; touch-action: none; border-radius: 20px; }

        /* æŒ‰éˆ•èˆ‡é€£çµ */
        .btn { padding: 12px 30px; border-radius: 30px; border: none; background: var(--primary-color); color: white; cursor: pointer; font-size: 1rem; margin: 10px 0; }
        .line-btn { background: #06C755; display: block; text-decoration: none; font-weight: bold; width: 200px; margin: 10px auto; }
        
        .footer-links { margin-top: 40px; border-top: 1px solid #ddd; padding: 20px; font-size: 0.9rem; width: 100%; max-width: 500px; text-align: left; }
        .footer-links h4 { margin-bottom: 8px; color: #555; border-left: 4px solid var(--primary-color); padding-left: 10px; }
        .footer-links a { color: #2c5d4d; text-decoration: none; display: block; margin: 5px 0; }
        
        /* èªéŸ³èˆ‡éœå¿ƒæç¤º */
        #meditation-overlay { font-style: italic; color: var(--primary-color); margin: 10px 0; min-height: 24px; }
    </style>
</head>
<body>

    <div id="home-page" class="page active">
        <header><h1>2026 åˆ®åˆ®æ¨‚ - æ­£å¿µæˆ‘çš„å¿ƒ</h1></header>
        <div class="instruction-box">
            <ol>
                <li>æ­£å¿µå†¥æƒ³ 30 ç§’</li>
                <li>å„ªå…ˆé¸æ“‡ä¸‰å€‹æœ€é—œå¿ƒçš„è­°é¡Œ</li>
                <li>å¸¶è‘—è¦ºçŸ¥ï¼Œåˆ®å‡ºæ‚¨çš„æ­£å¿µå¿ƒéˆå¡</li>
            </ol>
        </div>
        <button class="btn" onclick="startExperience()">é–‹å§‹éœå¿ƒé«”é©—</button>
        
        <div id="selection-area" style="display:none; margin-top: 20px;">
            <p id="meditation-overlay"></p>
            <div class="category-grid" id="catGrid">
                </div>
        </div>
    </div>

    <div id="scratch-page" class="page">
        <h1>å¸¶è‘—è¦ºçŸ¥ï¼Œåˆ®å‡ºæ‚¨çš„æ­£å¿µå¿ƒéˆå¡</h1>
        <div id="scratch-card">
            <div class="result-content" id="resultContainer">
                </div>
            <canvas id="scratchCanvas"></canvas>
        </div>
        
        <div id="action-area" style="display:none;">
            <a href="#" class="btn line-btn" onclick="shareLine()">ğŸ€ LINE åˆ†äº«ç¥ç¦</a>
            <button class="btn" style="background:#888" onclick="location.reload()">é‡æ–°é¸æ“‡</button>
        </div>
    </div>

    <div class="footer-links">
        <h4>å…¶ä»–åˆ®åˆ®æ¨‚</h4>
        <a href="https://scwei.github.io/energy-scratch/wish.html">2026 æ­£å¿µæ…ˆå¿ƒèƒ½é‡æŒ‡å¼•</a>
        
        <h4>è¿‘æœŸæ´»å‹• âœ¨</h4>
        <a href="https://himind.pse.is/balance2026" target="_blank">å…è²»å ±åï¼šè‡ªå¾‹ç¥ç¶“å¹³è¡¡èª²èªªæ˜æœƒ</a>
        <a href="https://himind.pse.is/8lax8f" target="_blank">å…è²»å ±åï¼šç¥å¥‡èƒ½é‡éšäº’å‹•æ•™å­¸</a>
        
        <h4>å­¸ç¿’è³‡æº ğŸ“–</h4>
        <a href="https://www.facebook.com/mindfulness.tw" target="_blank">æ›´å¤šæ­£å¿µå­¸ç¿’ (Facebook)</a>
        <a href="https://www.facebook.com/HiMindHealing" target="_blank">æ›´å¤šèƒ½é‡å­¸ç¿’ (Facebook)</a>
    </div>

    <script>
        const GAS_URL = "https://script.google.com/macros/s/AKfycbzLYgoIPlt_XHe8yZ8iVuc392FDcSXQDnzszBZxNjNZA5r7j1k2mZ0kVdS_GnGNX-2m/exec";
        const cats = ["å°ˆæ³¨åŠ›", "è¦ºå¯ŸåŠ›", "å‰µé€ åŠ›", "é—œä¿‚", "ç…§é¡§è€…", "å¾©åŸåŠ›", "å¥åº·", "å·¥ä½œ", "æƒ…ç·’"];
        let selected = [];

        // æ¨¡æ“¬é‡‘å¥è³‡æ–™åº«ï¼ˆéƒ¨åˆ†ç¯„ä¾‹ï¼‰
        const quotesData = {
            "å°ˆæ³¨åŠ›": ["å°ˆæ³¨æ–¼å‘¼å¸ï¼Œå°±æ˜¯çµ¦ç”Ÿå‘½æœ€å¥½çš„ç¦®ç‰©ã€‚", "ä¸€æ¬¡åªåšä¸€ä»¶äº‹ï¼Œå¿ƒå°±ä¸æœƒç´¯ã€‚", "ä½ çš„å¿ƒåœ¨å“ªè£¡ï¼ŒåŠ›é‡å°±åœ¨å“ªè£¡ã€‚"],
            "è¦ºå¯ŸåŠ›": ["è¦ºå¯Ÿæƒ…ç·’çš„èµ·ä¼ï¼Œä½†ä¸è¢«å®ƒå¸¶èµ°ã€‚", "çœ‹è¦‹ï¼Œå°±æ˜¯è½‰è®Šçš„é–‹å§‹ã€‚", "ç™¼ç¾åˆ†å¿ƒçš„ç¬é–“ï¼Œå°±æ˜¯æ­£å¿µã€‚"],
            "å‰µé€ åŠ›": ["å¿ƒç©ºäº†ï¼Œæ–°çš„é»å­æ‰èƒ½é€²ä¾†ã€‚", "å‰µé€ åŠ›æ˜¯éˆé­‚åœ¨ç©è€ã€‚", "åœ¨ç•™ç™½ä¸­ï¼Œéˆæ„Ÿè‡ªç¾ã€‚"],
            "é—œä¿‚": ["æœ€å¥½çš„é™ªä¼´ï¼Œæ˜¯æ”¾ä¸‹æ‰‹æ©Ÿçš„è†è½ã€‚", "å…ˆæ„›è‡ªå·±ï¼Œæ‰èƒ½æº«æŸ”åœ°æ„›åˆ¥äººã€‚", "åŸè«’æ˜¯ç‚ºäº†æ”¾éè‡ªå·±ã€‚"],
            "ç…§é¡§è€…": ["ç…§é¡§åˆ¥äººå‰ï¼Œè«‹å…ˆæŠ±æŠ±ç–²æ†Šçš„è‡ªå·±ã€‚", "ä½ çš„å¥½ï¼Œä¸éœ€è¦é€éçŠ§ç‰²ä¾†è­‰æ˜ã€‚", "ä½ å·²ç¶“åšå¾—å¾ˆå¥½äº†ã€‚"],
            "å¾©åŸåŠ›": ["å¤±æ•—åªæ˜¯æš«æ™‚çš„åœé “ï¼Œä¸æ˜¯çµ‚é»ã€‚", "å…§å¿ƒçš„éŸŒæ€§ï¼Œæ˜¯åœ¨é¢¨é›¨ä¸­ç·´å°±çš„ã€‚", "è£‚ç—•æ˜¯å…‰ç…§é€²ä¾†çš„åœ°æ–¹ã€‚"],
            "å¥åº·": ["å‚¾è½èº«é«”çš„ç´°èªï¼Œåˆ¥ç­‰å®ƒå¤§è²å¶å–Šã€‚", "é•·åä¸€å£æ°£ï¼Œå•Ÿå‹•ä½ çš„æ”¾é¬†é–‹é—œã€‚", "ä»Šå¤©çš„åŠªåŠ›åˆ°æ­¤ç‚ºæ­¢ï¼Œå®‰å¿ƒå…¥ç¡ã€‚"],
            "å·¥ä½œ": ["å¿™ç¢Œæ˜¯è¡¨è±¡ï¼Œå®šå¿ƒæ˜¯åŠŸå¤«ã€‚", "å£“åŠ›ä¾†è‡¨æ™‚ï¼Œå…ˆçµ¦è‡ªå·±ä¸‰å€‹å‘¼å¸ã€‚", "ä¸‹ç­çš„é‚£ä¸€åˆ»ï¼ŒæŠŠå·¥ä½œç•™åœ¨é–€å¤–ã€‚"],
            "æƒ…ç·’": ["æƒ…ç·’å¦‚æµªï¼Œä¾†å»è‡ªå¦‚ï¼Œè€Œä½ æ˜¯å¤§æµ·ã€‚", "ç„¦æ…®æ˜¯éˆé­‚è·‘å¾—å¤ªå¿«ï¼Œåœä¸‹ä¾†ç­‰å®ƒã€‚", "å¿«æ¨‚å¾ˆå¥½ï¼Œä¸å¿«æ¨‚ä¹Ÿæ²’é—œä¿‚ã€‚"]
        };

        function startExperience() {
            document.querySelector('#home-page > button').style.display = 'none';
            document.getElementById('selection-area').style.display = 'block';
            speakGuide();
        }

        // èªéŸ³å¼•å°åŠŸèƒ½
        function speakGuide() {
            const msg = new SpeechSynthesisUtterance();
            msg.text = "å¥½ï¼Œæˆ‘å€‘ç¾åœ¨ä¾†åš30ç§’çš„éœå¿ƒå†¥æƒ³ï¼Œè¼•è¼•çš„æŠŠçœ¼ç›é–‰ä¸Šï¼Œæ„Ÿå—ä¸€ä¸‹è‡ªå·±ç¾åœ¨èº«é«”çš„æ„Ÿè¦ºã€å‘¼å¸çš„ç¯€å¥ã€ç•¶æ‚¨æº–å‚™å¥½æ™‚ï¼Œå¯ä»¥å¼µé–‹çœ¼ç›ï¼Œé¸æ“‡æ‚¨é—œå¿ƒçš„ä¸‰å€‹é¡åˆ¥";
            msg.lang = 'zh-TW';
            msg.rate = 0.85; // èªé€Ÿæ…¢ä¸€é»æ›´æº«æŸ”
            
            // å°‹æ‰¾å¥³è²
            const voices = window.speechSynthesis.getVoices();
            const femaleVoice = voices.find(v => v.name.includes('Google åœ‹èª') || v.name.includes('Ya-Ling') || v.name.includes('Mei-Jia'));
            if(femaleVoice) msg.voice = femaleVoice;

            window.speechSynthesis.speak(msg);
            
            // ç•«é¢ä¸Šé¡¯ç¤ºå†¥æƒ³æç¤º
            const tip = document.getElementById('meditation-overlay');
            tip.innerText = "ğŸ§˜ æ­£åœ¨å¼•å°éœå¿ƒå†¥æƒ³ä¸­...";
            setTimeout(() => { tip.innerText = "âœ¨ è«‹é¸æ“‡æ‚¨é—œå¿ƒçš„ä¸‰å€‹è­°é¡Œ"; buildGrid(); }, 5000); // é€™è£¡ç¸®çŸ­å±•ç¤ºï¼Œå¯¦éš›å¯é…åˆèªéŸ³
        }

        function buildGrid() {
            const grid = document.getElementById('catGrid');
            grid.innerHTML = "";
            cats.forEach(c => {
                const div = document.createElement('div');
                div.className = 'cat-item';
                div.innerText = c;
                div.onclick = () => selectCat(c, div);
                grid.appendChild(div);
            });
        }

        function selectCat(name, el) {
            if(selected.includes(name)) {
                selected = selected.filter(i => i !== name);
                el.classList.remove('selected');
            } else if(selected.length < 3) {
                selected.push(name);
                el.classList.add('selected');
                if(selected.length === 3) {
                    setTimeout(goToScratch, 500); // é¸å®Œè‡ªå‹•è·³è½‰
                }
            }
        }

        function goToScratch() {
            document.getElementById('home-page').classList.remove('active');
            document.getElementById('scratch-page').classList.add('active');
            
            const results = selected.map(c => {
                const p = quotesData[c];
                return `<p><strong>#${c}</strong><br>${p[Math.floor(Math.random()*p.length)]}</p>`;
            }).join("");
            document.getElementById('resultContainer').innerHTML = results + "<hr><p style='font-size:0.8rem; color:var(--primary-color)'>é¡˜é€™ä»½æ­£å¿µé™ªä¼´æ‚¨çš„ 2026</p>";
            
            initCanvas();
            logToSheet();
        }

        // åˆ®åˆ®æ¨‚ç•«å¸ƒé‚è¼¯
        function initCanvas() {
            const canvas = document.getElementById('scratchCanvas');
            const ctx = canvas.getContext('2d');
            canvas.width = 320; canvas.height = 450;
            
            ctx.fillStyle = '#C0C0C0';
            ctx.fillRect(0, 0, 320, 450);
            
            // ç•«é»è£é£¾
            ctx.fillStyle = '#A9A9A9';
            for(let i=0; i<80; i++) ctx.fillRect(Math.random()*320, Math.random()*450, 2, 2);

            let isDrawing = false;
            
            function scratch(e) {
                if(!isDrawing) return;
                const rect = canvas.getBoundingClientRect();
                const x = (e.touches ? e.touches[0].clientX : e.clientX) - rect.left;
                const y = (e.touches ? e.touches[0].clientY : e.clientY) - rect.top;
                ctx.globalCompositeOperation = 'destination-out';
                ctx.beginPath(); ctx.arc(x, y, 30, 0, Math.PI*2); ctx.fill();
                handleAreaCheck(ctx, canvas);
            }

            canvas.addEventListener('mousedown', () => isDrawing = true);
            canvas.addEventListener('touchstart', () => isDrawing = true);
            window.addEventListener('mouseup', () => isDrawing = false);
            window.addEventListener('touchend', () => isDrawing = false);
            canvas.addEventListener('mousemove', scratch);
            canvas.addEventListener('touchmove', scratch);
        }

        // é¢ç©æª¢æŸ¥ï¼šè¶…é 40% è‡ªå‹•æ•£é–‹
        function handleAreaCheck(ctx, canvas) {
            const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
            const pixels = imageData.data;
            let transparent = 0;
            for (let i = 3; i < pixels.length; i += 4) {
                if (pixels[i] === 0) transparent++;
            }
            const percent = (transparent / (canvas.width * canvas.height)) * 100;
            if (percent > 40) {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                document.getElementById('action-area').style.display = 'block';
            }
        }

        async function logToSheet() {
            try {
                const ipRes = await fetch('https://ipapi.co/json/');
                const ipData = await ipRes.json();
                const payload = {
                    ip: ipData.ip, country: ipData.country_name,
                    time: new Date().toLocaleString(),
                    categories: selected.join(", "),
                    content: document.getElementById('resultContainer').innerText.replace(/\n/g, " ")
                };
                fetch(GAS_URL, { method: 'POST', mode: 'no-cors', body: JSON.stringify(payload) });
            } catch(e) { console.error(e); }
        }

        function shareLine() {
            const url = "https://scwei.github.io/energy-scratch/wish.html";
            const text = `2026åˆ®åˆ®æ¨‚- æ­£å¿µæˆ‘çš„å¿ƒ\n\n1. æ­£å¿µå†¥æƒ³1åˆ†é˜\n2. é‚€è«‹æ‚¨å„ªå…ˆé¸æ“‡ä¸‰å€‹æœ€é—œå¿ƒçš„è­°é¡Œ\n(å°ˆæ³¨åŠ›ã€è¦ºå¯ŸåŠ›ã€å‰µé€ åŠ›ã€é—œä¿‚ã€ç…§é¡§è€…ã€å¾©åŸåŠ›ã€å¥åº·ã€å·¥ä½œã€æƒ…ç·’)\n\n3. å¸¶è‘—è¦ºçŸ¥ï¼Œåˆ®å‡ºæ‚¨çš„æ­£å¿µå¿ƒéˆå¡\n\néŠæˆ²ç¶²å€ï¼š${url}`;
            window.location.href = `https://line.me/R/msg/text/?${encodeURIComponent(text)}`;
        }
    </script>
</body>
</html>
