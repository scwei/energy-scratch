<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2026 æ­£å¿µæˆ‘çš„å¿ƒ | åˆ®åˆ®æ¨‚èƒ½é‡ç¥ç¦</title>
    <style>
        :root {
            --primary-green: #5b8e7d;
            --bg-color: #f8f9fa;
            --silver: #C0C0C0;
        }
        
        body {
            font-family: 'PingFang TC', 'Microsoft JhengHei', sans-serif;
            background-color: var(--bg-color);
            margin: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            color: #333;
            min-height: 100vh;
        }

        header {
            margin: 30px 0;
            text-align: center;
        }

        h1 { color: #2c5d4d; margin-bottom: 5px; letter-spacing: 2px; }
        .subtitle { color: #666; font-size: 0.9rem; }

        /* åˆ†é¡é¸æ“‡å€ */
        .grid-container {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            max-width: 360px;
            padding: 20px;
            background: white;
            border-radius: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
        }

        .cat-item {
            padding: 15px 5px;
            border-radius: 12px;
            border: 2px solid #eee;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
            font-size: 0.9rem;
            text-align: center;
            background: white;
        }

        /* å„åˆ†é¡ç‰¹å®šè‰²å½© */
        .cat-item[data-cat="å°ˆæ³¨åŠ›"].selected { border-color: #1a508b; background: #eef5ff; color: #1a508b; }
        .cat-item[data-cat="è¦ºå¯ŸåŠ›"].selected { border-color: #6a097d; background: #f9f2fa; color: #6a097d; }
        .cat-item[data-cat="å‰µé€ åŠ›"].selected { border-color: #ff8e71; background: #fff4f1; color: #ff8e71; }
        .cat-item[data-cat="é—œä¿‚"].selected { border-color: #ffb6b9; background: #fff0f0; color: #ffb6b9; }
        .cat-item[data-cat="ç…§é¡§è€…"].selected { border-color: #00a8cc; background: #f0faff; color: #00a8cc; }
        .cat-item[data-cat="å¾©åŸåŠ›"].selected { border-color: #a39193; background: #f4f1f1; color: #a39193; }
        .cat-item[data-cat="å¥åº·"].selected { border-color: #81b214; background: #f5f9ed; color: #81b214; }
        .cat-item[data-cat="å·¥ä½œ"].selected { border-color: #456268; background: #f0f3f4; color: #456268; }
        .cat-item[data-cat="æƒ…ç·’"].selected { border-color: #ff4b5c; background: #fff2f3; color: #ff4b5c; }

        .btn-start {
            margin-top: 25px;
            padding: 12px 40px;
            background: var(--primary-green);
            color: white;
            border: none;
            border-radius: 30px;
            font-size: 1.1rem;
            cursor: pointer;
            box-shadow: 0 4px 10px rgba(91,142,125,0.3);
            display: none;
        }

        /* åˆ®åˆ®æ¨‚å€åŸŸ */
        #scratch-section {
            display: none;
            position: relative;
            margin-top: 20px;
        }

        #scratch-card {
            width: 320px;
            height: 450px;
            background: #fff;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            position: relative;
            overflow: hidden;
        }

        .result-container {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 30px;
            box-sizing: border-box;
            text-align: center;
        }

        .quote-box { margin-bottom: 20px; }
        .quote-tag { font-size: 0.7rem; color: #999; margin-bottom: 5px; display: block; }
        .quote-text { font-size: 1rem; line-height: 1.5; color: #333; font-weight: 500; }

        canvas {
            position: absolute;
            top: 0; left: 0;
            cursor: url('https://cdn-icons-png.flaticon.com/32/1484/1484568.png'), auto;
            touch-action: none;
        }

        .action-btns { margin-top: 20px; display: none; flex-direction: column; gap: 10px; width: 320px;}
        .line-btn { background: #06C755; color: white; border: none; padding: 12px; border-radius: 10px; cursor: pointer; text-decoration: none; font-weight: bold; }

        footer { margin-top: 50px; padding: 20px; text-align: center; font-size: 0.9rem; }
        footer a { color: #5b8e7d; text-decoration: none; margin: 0 10px; }
    </style>
</head>
<body>

<header>
    <h1>2026 æ­£å¿µæˆ‘çš„å¿ƒ</h1>
    <div class="subtitle">é‚€è«‹æ‚¨å„ªå…ˆé¸æ“‡ä¸‰å€‹æœ€é—œå¿ƒçš„è­°é¡Œ</div>
</header>

<div class="grid-container" id="categoryGrid">
    <div class="cat-item" data-cat="å°ˆæ³¨åŠ›">å°ˆæ³¨åŠ›</div>
    <div class="cat-item" data-cat="è¦ºå¯ŸåŠ›">è¦ºå¯ŸåŠ›</div>
    <div class="cat-item" data-cat="å‰µé€ åŠ›">å‰µé€ åŠ›</div>
    <div class="cat-item" data-cat="é—œä¿‚">é—œä¿‚</div>
    <div class="cat-item" data-cat="ç…§é¡§è€…">ç…§é¡§è€…</div>
    <div class="cat-item" data-cat="å¾©åŸåŠ›">å¾©åŸåŠ›</div>
    <div class="cat-item" data-cat="å¥åº·">å¥åº·</div>
    <div class="cat-item" data-cat="å·¥ä½œ">å·¥ä½œ</div>
    <div class="cat-item" data-cat="æƒ…ç·’">æƒ…ç·’</div>
</div>

<button id="startBtn" class="btn-start">é–‹å§‹åˆ®å‡ºèƒ½é‡é‡‘å¥</button>

<section id="scratch-section">
    <div id="scratch-card">
        <div class="result-container" id="resultBox">
            </div>
        <canvas id="scratchCanvas"></canvas>
    </div>
    
    <div class="action-btns" id="actionBtns">
        <button class="line-btn" onclick="shareLine()">ğŸ€ LINE åˆ†äº«ç¥ç¦</button>
        <button onclick="location.reload()" style="background:none; border:1px solid #ccc; padding:8px; border-radius:10px; cursor:pointer;">é‡æ–°é¸å–</button>
    </div>
</section>

<footer>
    <a href="#">è¿‘æœŸæ´»å‹• âœ¨</a> | <a href="#">å­¸ç¿’è³‡æº ğŸ“–</a>
</footer>

<script>
    const GAS_URL = "https://script.google.com/macros/s/AKfycbzLYgoIPlt_XHe8yZ8iVuc392FDcSXQDnzszBZxNjNZA5r7j1k2mZ0kVdS_GnGNX-2m/exec";

    // éš¨æ©Ÿé‡‘å¥è³‡æ–™åº« (é€™è£¡æ”¾å…¥ä¹‹å‰ç”Ÿæˆçš„300å¥ç¯„ä¾‹ï¼Œå¯¦å‹™ä¸Šå¯å±•é–‹)
    const quotesData = {
        "å°ˆæ³¨åŠ›": ["å°ˆæ³¨æ–¼å‘¼å¸ï¼Œå°±æ˜¯çµ¦ç”Ÿå‘½æœ€å¥½çš„ç¦®ç‰©ã€‚", "ä¸€æ¬¡åªåšä¸€ä»¶äº‹ï¼Œå¿ƒå°±ä¸æœƒç´¯ã€‚", "ä½ çš„å¿ƒåœ¨å“ªè£¡ï¼ŒåŠ›é‡å°±åœ¨å“ªè£¡ã€‚", "æ…¢ä¸‹ä¾†ï¼Œæ˜¯ç‚ºäº†çœ‹æ¸…æœ€æ ¸å¿ƒçš„äº‹ã€‚"],
        "è¦ºå¯ŸåŠ›": ["è¦ºå¯Ÿæƒ…ç·’çš„èµ·ä¼ï¼Œä½†ä¸è¢«å®ƒå¸¶èµ°ã€‚", "çœ‹è¦‹ï¼Œå°±æ˜¯è½‰è®Šçš„é–‹å§‹ã€‚", "ç™¼ç¾åˆ†å¿ƒçš„ç¬é–“ï¼Œå°±æ˜¯æ­£å¿µçš„é–‹å§‹ã€‚", "æº«æŸ”åœ°çœ‹è‘—ä½ çš„ä¸å®‰ï¼Œå®ƒæœƒæ…¢æ…¢å®‰éœã€‚"],
        "å‰µé€ åŠ›": ["å¿ƒç©ºäº†ï¼Œæ–°çš„é»å­æ‰èƒ½é€²ä¾†ã€‚", "å‰µé€ åŠ›æ˜¯éˆé­‚åœ¨ç©è€ã€‚", "åœ¨ç•™ç™½ä¸­ï¼Œéˆæ„Ÿè‡ªç¾ã€‚", "æ¯ä¸€åˆ»çš„è¦ºå¯Ÿï¼Œéƒ½æ˜¯æ–°çš„å‰µä½œç´ æã€‚"],
        "é—œä¿‚": ["æœ€å¥½çš„é™ªä¼´ï¼Œæ˜¯æ”¾ä¸‹æ‰‹æ©Ÿçš„è†è½ã€‚", "å…ˆæ„›è‡ªå·±ï¼Œæ‰èƒ½æº«æŸ”åœ°æ„›åˆ¥äººã€‚", "åœ¨é—œä¿‚ä¸­ä¿æœ‰è‡ªæˆ‘ï¼Œæ„›æ‰ä¸æœƒæ²‰é‡ã€‚", "åŸè«’ä¸æ˜¯ç‚ºäº†åˆ¥äººï¼Œæ˜¯ç‚ºäº†æ”¾éè‡ªå·±ã€‚"],
        "ç…§é¡§è€…": ["ç…§é¡§åˆ¥äººå‰ï¼Œè«‹å…ˆæŠ±æŠ±ç–²æ†Šçš„è‡ªå·±ã€‚", "ä½ çš„å¥½ï¼Œä¸éœ€è¦é€éçŠ§ç‰²ä¾†è­‰æ˜ã€‚", "ä½ å·²ç¶“åšå¾—å¾ˆå¥½äº†ï¼Œæ”¾è¼•é¬†é»ã€‚", "ä¼‘æ¯ä¸æ˜¯å·æ‡¶ï¼Œæ˜¯ç‚ºäº†èµ°æ›´é çš„è·¯ã€‚"],
        "å¾©åŸåŠ›": ["å¤±æ•—åªæ˜¯æš«æ™‚çš„åœé “ï¼Œä¸æ˜¯çµ‚é»ã€‚", "å…§å¿ƒçš„éŸŒæ€§ï¼Œæ˜¯åœ¨é¢¨é›¨ä¸­ç·´å°±çš„ã€‚", "æ¥ç´è„†å¼±ï¼Œæ­£æ˜¯å …å¼·çš„è¡¨ç¾ã€‚", "è£‚ç—•æ˜¯å…‰ç…§é€²ä¾†çš„åœ°æ–¹ã€‚"],
        "å¥åº·": ["å‚¾è½èº«é«”çš„ç´°èªï¼Œåˆ¥ç­‰å®ƒå¤§è²å¶å–Šã€‚", "é•·åä¸€å£æ°£ï¼Œå•Ÿå‹•ä½ çš„æ”¾é¬†é–‹é—œã€‚", "ä»Šå¤©çš„åŠªåŠ›åˆ°æ­¤ç‚ºæ­¢ï¼Œå®‰å¿ƒå…¥ç¡ã€‚", "æ¯ä¸€å£å‘¼å¸ï¼Œéƒ½åœ¨æ›´æ–°ä½ çš„ç´°èƒã€‚"],
        "å·¥ä½œ": ["å¿™ç¢Œæ˜¯è¡¨è±¡ï¼Œå®šå¿ƒæ˜¯åŠŸå¤«ã€‚", "å£“åŠ›ä¾†è‡¨æ™‚ï¼Œå…ˆçµ¦è‡ªå·±ä¸‰å€‹å‘¼å¸ã€‚", "ä¸‹ç­çš„é‚£ä¸€åˆ»ï¼ŒæŠŠå·¥ä½œç•™åœ¨é–€å¤–ã€‚", "å·¥ä½œçš„åƒ¹å€¼ï¼Œç”±ä½ å…§å¿ƒçš„å¹³éœå®šç¾©ã€‚"],
        "æƒ…ç·’": ["æƒ…ç·’å¦‚æµªï¼Œä¾†å»è‡ªå¦‚ï¼Œè€Œä½ æ˜¯å»£é—Šçš„å¤§æµ·ã€‚", "çœ‹è¦‹æ†¤æ€’ï¼Œè€Œä¸æˆç‚ºæ†¤æ€’ã€‚", "ç„¦æ…®æ˜¯éˆé­‚è·‘å¾—å¤ªå¿«ï¼Œè«‹åœä¸‹ä¾†ç­‰ä¸€ç­‰å®ƒã€‚", "å¿«æ¨‚å¾ˆå¥½ï¼Œä¸å¿«æ¨‚ä¹Ÿæ²’é—œä¿‚ã€‚"]
    };

    let selectedCats = [];
    const gridItems = document.querySelectorAll('.cat-item');
    const startBtn = document.getElementById('startBtn');

    gridItems.forEach(item => {
        item.addEventListener('click', () => {
            const cat = item.getAttribute('data-cat');
            if (selectedCats.includes(cat)) {
                selectedCats = selectedCats.filter(i => i !== cat);
                item.classList.remove('selected');
            } else if (selectedCats.length < 3) {
                selectedCats.push(cat);
                item.classList.add('selected');
            }
            startBtn.style.display = selectedCats.length === 3 ? 'block' : 'none';
        });
    });

    startBtn.addEventListener('click', initScratch);

    function initScratch() {
        document.getElementById('categoryGrid').style.display = 'none';
        startBtn.style.display = 'none';
        document.querySelector('.subtitle').style.display = 'none';
        document.getElementById('scratch-section').style.display = 'flex';
        document.getElementById('scratch-section').style.flexDirection = 'column';
        document.getElementById('scratch-section').style.alignItems = 'center';

        // æŠ½å–é‡‘å¥
        const results = selectedCats.map(cat => {
            const pool = quotesData[cat];
            return { cat: cat, text: pool[Math.floor(Math.random() * pool.length)] };
        });

        const resultBox = document.getElementById('resultBox');
        resultBox.innerHTML = results.map(r => `
            <div class="quote-box">
                <span class="quote-tag"># ${r.cat}</span>
                <div class="quote-text">${r.text}</div>
            </div>
        `).join('');

        setupCanvas();
        sendDataToSheet(results.map(r => `[${r.cat}]${r.text}`).join(' / '));
    }

    function setupCanvas() {
        const canvas = document.getElementById('scratchCanvas');
        const ctx = canvas.getContext('2d');
        canvas.width = 320;
        canvas.height = 450;

        // ç¹ªè£½éŠ€è‰²å±¤
        ctx.fillStyle = '#C0C0C0';
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        
        // åŠ ä¸Šä¸€é»ç´‹ç†æ„Ÿ
        ctx.fillStyle = '#A9A9A9';
        for(let i=0; i<100; i++) {
            ctx.fillRect(Math.random()*canvas.width, Math.random()*canvas.height, 2, 2);
        }

        ctx.font = "20px Arial";
        ctx.fillStyle = "#888";
        ctx.textAlign = "center";
        ctx.fillText("è«‹åœ¨æ­¤åˆ®é–‹èƒ½é‡", 160, 225);

        let isDrawing = false;
        let scratchedAmount = 0;

        function getPointerPos(e) {
            const rect = canvas.getBoundingClientRect();
            const clientX = e.touches ? e.touches[0].clientX : e.clientX;
            const clientY = e.touches ? e.touches[0].clientY : e.clientY;
            return { x: clientX - rect.left, y: clientY - rect.top };
        }

        function scratch(e) {
            if (!isDrawing) return;
            const pos = getPointerPos(e);
            ctx.globalCompositeOperation = 'destination-out';
            ctx.beginPath();
            ctx.arc(pos.x, pos.y, 30, 0, Math.PI * 2);
            ctx.fill();
            checkScratch();
        }

        function checkScratch() {
            scratchedAmount++;
            if (scratchedAmount > 50) { // ç°¡å–®é–€æª»
                document.getElementById('actionBtns').style.display = 'flex';
            }
        }

        canvas.addEventListener('mousedown', () => isDrawing = true);
        canvas.addEventListener('touchstart', () => isDrawing = true);
        window.addEventListener('mouseup', () => isDrawing = false);
        window.addEventListener('touchend', () => isDrawing = false);
        canvas.addEventListener('mousemove', scratch);
        canvas.addEventListener('touchmove', scratch);
    }

    async function sendDataToSheet(content) {
        try {
            const ipRes = await fetch('https://ipapi.co/json/');
            const ipData = await ipRes.json();
            
            const payload = {
                ip: ipData.ip,
                country: ipData.country_name,
                time: new Date().toLocaleString(),
                categories: selectedCats.join(', '),
                content: content
            };

            fetch(GAS_URL, {
                method: 'POST',
                mode: 'no-cors',
                cache: 'no-cache',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });
        } catch (e) { console.log("Logging failed", e); }
    }

    function shareLine() {
        const msg = encodeURIComponent(`ã€2026 æ­£å¿µæˆ‘çš„å¿ƒã€‘\næˆ‘ç‚ºè‡ªå·±åˆ®é–‹äº†ã€Œ${selectedCats.join('ã€')}ã€çš„èƒ½é‡ç¥ç¦ï¼Œæ„Ÿè¦ºå¿ƒéˆè¢«ç™‚ç™’äº†ï¼âœ¨\nä½ ä¹Ÿä¾†åˆ®å‡ºä½ çš„å¹´åº¦é‡‘å¥å§ï¼ç¶²å€ï¼šhttps://scwei.github.io/energy-scratch/mindfulness.html `);
        window.location.href = `https://line.me/R/msg/text/?${msg}`;
    }
</script>

</body>
</html>
